---
title: "PowerAnalysis-LabelConcept"
author: "Bria Long"
date: "3/8/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(BayesFactor)
library(BFDA)
```

## Extract effect sizes from meta-analysis for conditions and age ranges of interest
```{r}
meta=as.tibble(read.csv('Label advantage in concept learning.csv')) 

# reported in abstract, across all conditions and ages
effectSizes_All<- meta %>%
  filter(audio_condition %in% c("noun","silence", "non-linguistic sound")) %>%
  group_by(audio_condition) %>%
  summarize(meanEffect = mean(g_calc), sdEffect = sd(d_calc), countStudies = length(g_calc))

# used for power analysis -- target sample sizes
effectSizes_Targeted<- meta %>%
  filter(audio_condition %in% c("noun","silence", "non-linguistic sound")) %>%
  filter(mean_age_months > 11) %>%  # using 11 rather than 12 allows to include a few extra studeis
  filter(response_mode ==  "eye-tracking") %>%
  group_by(audio_condition) %>%
  summarize(meanEffect_Targeted = mean(g_calc), sdEffect_Targeted = sd(g_calc), countStudies = length(g_calc))

```

## Text in ICIS abstract

To gain clarity on this complex literature, we conducted a systematic meta-analysis of this literature, including `r length(meta$study_ID)` conditions from `r length(unique(meta$study_ID))` papers and `r sum(meta$n)` infants. We found an overall effect size for category formation of Hedgesâ€™ g = `r round(mean(meta$g_calc),2)`. The strength of this effect varied as a function of auditory cues, however: nouns elicited consistency greater novelty preferences than non-linguistic tones (noun, Hedges' g M = `r round(effectSizes_All$meanEffect[2],2)`, SD = `r round(effectSizes_All$sdEffect[2],2)`; tones, Hedges' g M = `r round(effectSizes_All$meanEffect[1],2)`, SD = `r round(effectSizes_All$sdEffect[1],2)`); ; and categories learned during silence also generated novelty preferences (silence, Hedges' g M = `r round(effectSizes_All$meanEffect[3],2)`, SD = `r round(effectSizes_All$sdEffect[3],2)`.

```{r}
knitr::kable(effectSizes_All, digits = 2)
knitr::kable(effectSizes_Targeted, digits = 2)
```



## H1 hypothesis simulation
#### Note: BDFA demo gives same warnings for plotting functions, ignoring here
```{r}
## parameters for both simulations and analyses
boundaryBF = 10
n.min = 20
n.max = 50
stepsize = 5

## H1: Difference between labels and tones is as predicted by meta-analysis
LabelsVTones = effectSizes_Targeted$meanEffect_Targeted[2]-effectSizes_Targeted$meanEffect_Targeted[1]
s1 <- BFDA.sim(expected.ES=LabelsVTones, n.min=n.min, stepsize=stepsize, n.max=n.max, type="t.between", design="sequential", r=sqrt(2)/2, alternative="directional", cores=4, boundary=boundaryBF)
a1 <- BFDA.analyze(s1, design="sequential", n.min=n.min, boundary=boundaryBF)
a1
plot(s1)

```


## Null hypothesis simulation 
```{r}
## Null hypothesis: no difference between labels and tones
s0 <- BFDA.sim(expected.ES=0, n.min=n.min, stepsize=stepsize, n.max=n.max, type="t.between", design="sequential", r=sqrt(2)/2, alternative="directional", cores=4,boundary=boundaryBF)
a0 <- BFDA.analyze(s0, design="sequential", n.min=n.min, boundary=boundaryBF)
a0
plot(s0)

```


#### NOT INCLUDED: Considered trying to incoporate variability estimates into effect size simulations via extra simualtions, but did not given that the sd estimates for tones are from a very small N in this age range 
```{r}
ES_mean_tones <- effectSizes_Targeted$meanEffect_Targeted[1]
ES_sd_tones <- effectSizes_Targeted$sdEffect_Targeted[1]

ES_mean_labels <- effectSizes_Targeted$meanEffect_Targeted[2]
ES_sd_labels <- effectSizes_Targeted$sdEffect_Targeted[2]

n_sims <- 500
sims <- as.tibble(expand.grid(sim = 1:n_sims)) %>%
  mutate(idx = 1:n()) %>%
  split(.$idx) %>%
  map_df(function (x) {
    mu_es_labels <- rnorm(n = 1, mean = ES_mean_labels, sd = ES_sd_labels) # simulate an effect size for labels from this   distribution
    mu_es_tones <- rnorm(n = 1, mean = ES_mean_tones, sd = ES_sd_tones) # simulate an effect size for tones
    es_diff_sim <- mu_es_labels - mu_es_tones # output simulated diff in effect size - labels vs. tones
    x$es_diff_sim = es_diff_sim
    return (x)
  })

ES_diff_estimate_mean = mean(sims$es_diff_sim)
ES_diff_estimate_sd = sd(sims$es_diff_sim)

```